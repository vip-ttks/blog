
<!DOCTYPE HTML><html><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=10,IE=9,IE=8"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0"><title>ffmpeg转码，推流指南 &#8211; 远道者的博客</title><script>
window._deel = {name: '远道者的博客',url: '                     /wp-content/themes/yusi1.0', ajaxpager: '', commenton: 0, roll: [0,0]}
</script><link rel='dns-prefetch' href='//libs.baidu.com' /><link rel='dns-prefetch' href='//s.w.org' /><script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.2.1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.2.1\/svg\/","svgExt":".svg","source":{"concatemoji":"\/wp-includes\/js\/wp-emoji-release.min.js?$version"}};
			!function(a,b,c){function d(a){var b,c,d,e,f=String.fromCharCode;if(!k||!k.fillText)return!1;switch(k.clearRect(0,0,j.width,j.height),k.textBaseline="top",k.font="600 32px Arial",a){case"flag":return k.fillText(f(55356,56826,55356,56819),0,0),!(j.toDataURL().length<3e3)&&(k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57331,65039,8205,55356,57096),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57331,55356,57096),0,0),c=j.toDataURL(),b!==c);case"emoji4":return k.fillText(f(55357,56425,55356,57341,8205,55357,56507),0,0),d=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55357,56425,55356,57341,55357,56507),0,0),e=j.toDataURL(),d!==e}return!1}function e(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i,j=b.createElement("canvas"),k=j.getContext&&j.getContext("2d");for(i=Array("flag","emoji4"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script><style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style><link rel='stylesheet' id='style-css'  href='/wp-content/themes/yusi1.0/style_668372156ca6fe077f51c44ef2c4a6e6.css' type='text/css' media='all' /><script type='text/javascript' src='//libs.baidu.com/jquery/1.8.3/jquery.min.js?ver=1.0'></script><script type='text/javascript' src='/wp-content/themes/yusi1.0/js/jquery_668372156ca6fe077f51c44ef2c4a6e6.js'></script><link rel='https://api.w.org/' href='/wp-json//index.html' /><link rel='prev' title='gearman环境搭建' href='/archives/17/index.html' /><link rel='next' title='html a标签' href='/archives/45/index.html' /><link rel="canonical" href="/archives/27/index.html" /><link rel='shortlink' href='/fd6d6d768f2cc809a770910e090df063.html' /><link rel="alternate" type="application/json+oembed" href="/wp-json/oembed/1.0/embed/d6cf2dc19d5dd5af259eb010820def31.html" /><link rel="alternate" type="text/xml+oembed" href="                     /wp-json/oembed/1.0/embed?url=http%3A%2F%2F127.0.0.1%3A8000%2Farchives%2F27&#038;format=xml" /><script type="text/javascript" src="/wp-content/plugins/ueditor/ueditor/third-party/SyntaxHighlighter/shCore.js"></script><link type="text/css" rel="stylesheet" href=" /wp-content/plugins/ueditor/ueditor/third-party/SyntaxHighlighter/shCoreDefault.css" /><meta name="keywords" content="工作技术"><meta name="description" content="ffmpeg的安装部署Windows下面的安装：浏览器打开https://ffmpeg.zeranoe.com/builds/选择好版本，位数如果不确定的话就下载32bit的，然后选择static，然后下载下载完成后解压 复制其中的ffmpeg.exe 到系统目录C:\Windows\System32Linux下面的安装：可以到官方网站下载 我提供了一个下载地址http://7xl66y.com1.z0.glb.clouddn.com/"><!--[if lt IE 9]><script src="/wp-content/themes/yusi1.0/js/html5.js"></script><![endif]--></head><body class="post-template-default single single-post postid-27 single-format-standard"><header id="header" class="header"><div class="container-inner"><div class="yusi-logo"><a href="/"><h1><span class="yusi-mono">远道者的博客</span><span class="yusi-bloger">技术文章</span></h1></a></div></div><div id="nav-header" class="navbar"><ul class="nav"><div class="menu"></div><li style="float:right;"><div class="toggle-search"><i class="fa fa-search"></i></div><div class="search-expand" style="display: none;"><div class="search-expand-inner"><form method="get" class="searchform themeform" onsubmit="location.href='                     /search/' + encodeURIComponent(this.s.value).replace(/%20/g, '+'); return false;" action="/"><div><input type="ext" class="search" name="s" onblur="if(this.value=='')this.value='search...';" onfocus="if(this.value=='search...')this.value='';" value="search..."></div></form></div></div></li></ul></div></div></header><section class="container"><div class="speedbar"><div class="toptip"><strong class="text-success"><i class="fa fa-volume-up"></i></strong></div></div><div class="content-wrap"><div class="content"><header class="article-header"><h1 class="article-title"><a href="/archives/27/index.html">ffmpeg转码，推流指南</a></h1><div class="meta"><span id="mute-category" class="muted"><i class="fa fa-list-alt"></i><a href="/archives/category//index.html"> 工作技术</a></span><span class="muted"><i class="fa fa-user"></i><a href="/archives/author/admin/index.html">admin</a></span><time class="muted"><i class="fa fa-clock-o"></i> 1年前 (2017-04-13)</time><span class="muted"><i class="fa fa-eye"></i> 159℃</span></div></header><article class="article-content"><h1>ffmpeg的安装部署<br /></h1><h2>Windows下面的安装：</h2><p>浏览器打开<a href="https://ffmpeg.zeranoe.com/builds/" target="_self">https://ffmpeg.zeranoe.com/builds/</a></p><p>选择好版本，位数如果不确定的话就下载32bit的，然后选择static，然后下载</p><p>下载完成后解压 复制其中的ffmpeg.exe 到系统目录C:\Windows\System32</p><h2>Linux下面的安装：</h2><p>可以到官方网站下载 我提供了一个下载地址<a href="http://7xl66y.com1.z0.glb.clouddn.com/ffmpeg-release-64bit-static.tar.xz" target="_self">http://7xl66y.com1.z0.glb.clouddn.com/ffmpeg-release-64bit-static.tar.xz</a></p><p>解压后复制到系统目录&nbsp;/usr/bin</p><p>windows版本下载<a href="http://7xl66y.com1.z0.glb.clouddn.com/ffmpeg.exe" _src="http://7xl66y.com1.z0.glb.clouddn.com/ffmpeg.exe">http://7xl66y.com1.z0.glb.clouddn.com/ffmpeg.exe</a></p><h1>转码实例</h1><p><strong>示例1</strong>：转封装，比如想把ts格式的文件转成mp4 不想改变码率，编码器只想换种格式的</p><pre class="brush:bash;toolbar:false">ffmpeg&nbsp;-i&nbsp;d:/源文件.ts&nbsp;-vcodec&nbsp;copy&nbsp;-acodec&nbsp;copy&nbsp;d:/目标文件.mp4</pre><p>如果上述命令出现如下错误信息use the audio bitstream filter &#39;aac_adtstoasc&#39; to fix it</p><p>请添加如下命令：</p><pre class="brush:bash;toolbar:false">ffmpeg&nbsp;-i&nbsp;d:/源文件.ts&nbsp;-vcodec&nbsp;copy&nbsp;-acodec&nbsp;copy&nbsp;-bsf:a&nbsp;aac_adtstoasc&nbsp;d:/目标文件.mp4</pre><p></p><p><strong>示例2</strong>:转码 想改变视频的码率 比如源片是20G 想要转成小点的视频，指定码率1000kbps</p><pre class="brush:bash;toolbar:false">ffmpeg&nbsp;-i&nbsp;d:/源文件.ts&nbsp;-vcodec&nbsp;libx264&nbsp;-preset:v&nbsp;medium&nbsp;-b:v&nbsp;1000k&nbsp;-acodec&nbsp;copy&nbsp;d:/目标文件.mp4</pre><p>如果要使用-acodec copy的话，不一定能成功，如果失败了，就去除，只不过这样转码时间会稍微多点</p><p></p><p><strong>示例3</strong>：转码 指定分辨率为1280*720</p><pre class="brush:bash;toolbar:false">ffmpeg&nbsp;-i&nbsp;d:/源文件.ts&nbsp;-vcodec&nbsp;libx264&nbsp;-preset:v&nbsp;medium&nbsp;-b:v&nbsp;1000k&nbsp;-s&nbsp;1280x720&nbsp;-acodec&nbsp;copy&nbsp;d:/目标文件.mp4</pre><p></p><p><strong>示例4</strong>：为了转码出的mp4能够被Html5播放 指定视频的编码格式为h264 音频为aac</p><pre class="brush:bash;toolbar:false">ffmpeg&nbsp;-i&nbsp;d:/源文件.ts&nbsp;-vcodec&nbsp;libx264&nbsp;-preset:v&nbsp;medium&nbsp;-b:v&nbsp;1000k&nbsp;-s&nbsp;1280x720&nbsp;-acodec&nbsp;aac&nbsp;d:/目标文件.mp4</pre><p style="white-space: normal;"><strong><br /></strong></p><p style="white-space: normal;"></p><p style="white-space: normal;"><strong>示例5</strong>：MP4视频无损旋转</p><p style="white-space: normal;">例如要顺时针旋转90°</p><pre class="brush:bash;toolbar:false">ffmpeg&nbsp;-i&nbsp;d:/源文件.mp4&nbsp;-codec&nbsp;copy&nbsp;-metadata:s:v&nbsp;rotate=&quot;90&quot;&nbsp;d:/目标文件.mp4</pre><p style="white-space: normal;"><strong><br /></strong></p><p style="white-space: normal;"><strong>示例6</strong>：视频转码旋转</p><p style="white-space: normal;">示例5只是在封装容器中设置参数，告诉播放器需要旋转播放，如果播放器不支持或者容器不支持就</p><p style="white-space: normal;">不行了，下面的方法可以保证不管什么格式都支持，依旧是顺时针90° 命令中一个PI表示180°</p><pre class="brush:bash;toolbar:false">ffmpeg&nbsp;-i&nbsp;d:/源文件.ts&nbsp;-vcodec&nbsp;h264&nbsp;-vf&nbsp;rotate=-PI/2&nbsp;-acodec&nbsp;aac&nbsp;-movflags&nbsp;+faststart&nbsp;d:/目标文件.mp4</pre><p style="white-space: normal;"><strong><br /></strong></p><p style="white-space: normal;"><strong>示例6</strong>：多个视频合并</p><p style="white-space: normal;">比如有如下视频1.mp4 2.ts 3.ts 4.mkv 5.avi需要一次合并成dst.mp4</p><p style="white-space: normal;">那么第一步写列表文件，创建一个list.txt把如下内容填写进去</p><pre class="brush:bash;toolbar:false">file&nbsp;&#39;1.mp4&#39;
file&nbsp;&#39;2.ts&#39;
file&nbsp;&#39;3.ts&#39;
file&nbsp;&#39;4.mkv&#39;
file&nbsp;&#39;5.avi&#39;</pre><p>然后再执行命令</p><pre class="brush:bash;toolbar:false">ffmpeg&nbsp;-f&nbsp;concat&nbsp;-i&nbsp;list.txt&nbsp;-vcodec&nbsp;h264&nbsp;-acodec&nbsp;aac&nbsp;-movflags&nbsp;+faststart&nbsp;d:/目标文件.mp4</pre><h1>rtmp推流</h1><h2>推流地址</h2><p>香港卫视 rtmp://live.hkstv.hk.lxdns.com/live/hks<br />香港卫视 <a href="http://live.hkstv.hk.lxdns.com/live/hks/playlist.m3u8" _src="http://live.hkstv.hk.lxdns.com/live/hks/playlist.m3u8">http://live.hkstv.hk.lxdns.com/live/hks/playlist.m3u8</a></p><p>修改其中的id就能变成自己的推流地址和播放地址了，有点邪恶，他们没有做防盗链</p><p>如果推流的时候用本地视频做源，注意加参数<span style="color: rgb(255, 0, 0);">-re</span></p><p>不然会直接最大速度推流，导致1个小时的视频可能10来分钟就完了,下面是循环推送本地文件e.f4v作为rtmp,如果e.f4v是30分钟，那么就会推30分钟才会结束</p><pre class="brush:bash;toolbar:false">ffmpeg&nbsp;-re&nbsp;-i&nbsp;d:/Media/e.f4v&nbsp;-s&nbsp;640x480&nbsp;-vcodec&nbsp;libx264&nbsp;-acodec&nbsp;aac&nbsp;-strict&nbsp;-2&nbsp;-ar&nbsp;44100&nbsp;-ac&nbsp;2&nbsp;-b:v&nbsp;400k&nbsp;-f&nbsp;flv&nbsp;rtmp://live.hkstv.hk.lxdns.com/live/test</pre><h2>摄像头推流<br /></h2><p><strong>推UDP流</strong></p><pre class="brush:bash;toolbar:false">ffmpeg&nbsp;-f&nbsp;dshow&nbsp;-i&nbsp;video=&quot;Integrated&nbsp;Camera&quot;&nbsp;-vcodec&nbsp;libx264&nbsp;-preset:v&nbsp;ultrafast\
&nbsp;-tune:v&nbsp;zerolatency&nbsp;-f&nbsp;mpegts&nbsp;udp://230.0.0.1:6000</pre><p><strong>推rtmp流</strong></p><pre class="brush:bash;toolbar:false">ffmpeg&nbsp;-f&nbsp;dshow&nbsp;-i&nbsp;video=&quot;Integrated&nbsp;Camera&quot;&nbsp;-vcodec&nbsp;libx264&nbsp;-preset:v&nbsp;ultrafast\
&nbsp;-tune:v&nbsp;zerolatency&nbsp;-f&nbsp;flv&nbsp;rtmp://live.hkstv.hk.lxdns.com/live/demo</pre><p><strong>出hls流</strong></p><pre class="brush:bash;toolbar:false">ffmpeg&nbsp;-f&nbsp;dshow&nbsp;-i&nbsp;video=&quot;Integrated&nbsp;Camera&quot;&nbsp;-vcodec&nbsp;libx264&nbsp;-preset:v&nbsp;ultrafast\
&nbsp;-tune:v&nbsp;zerolatency&nbsp;-f&nbsp;hls&nbsp;d:/mp4/test.m3u8</pre><p></p><p>-r 25 设置帧率</p><p>-s 1280&#215;720 指定分辨率 默认640&#215;480</p><p>-g 1 -keyint_min 2 设置关键帧间隔 默认的间隔太大 加载时间会很长</p><p>-b 1000k 设置码率 这个是设置1000kbps的 效果还是蛮好的 如果只设置视频的码率 -b:v 1000k</p><p></p><p>转载请注明：<a href="                    /">远道者的博客</a> &raquo; <a href="/archives/27/index.html">ffmpeg转码，推流指南</a></p><div class="article-social"><a href="javascript:;" data-action="ding" data-id="27" id="Addlike" class="action"><i class="fa fa-heart-o"></i>喜欢 (<span class="count">0</span>)</a></div></article><footer class="article-footer"></footer><nav class="article-nav"><span class="article-nav-prev"><i class="fa fa-angle-double-left"></i><a href="/archives/17/index.html" rel="prev">gearman环境搭建</a></span><span class="article-nav-next"><a href="/archives/45/index.html" rel="next">html a标签</a><i class="fa fa-angle-double-right"></i></span></nav><div class="related_top"><div class="related_posts"><ul class="related_img"><li class="related_box"  ><a href="/archives/703/index.html" title="bash脚本计算某程序的进程数" target="_blank"><img src="/wp-content/themes/yusi1.0/timthumb_c34e4477c8028c2fa5cf6039ca78e897.html" alt="bash脚本计算某程序的进程数" /><br><span class="r_title">bash脚本计算某程序的进程数</span></a></li><li class="related_box"  ><a href="/archives/701/index.html" title="gif添加水印" target="_blank"><img src="/wp-content/themes/yusi1.0/timthumb_e4078b04e4e326a63034bcce976de702.html" alt="gif添加水印" /><br><span class="r_title">gif添加水印</span></a></li><li class="related_box"  ><a href="/archives/692/index.html" title="centos开机启动脚本" target="_blank"><img src="/wp-content/themes/yusi1.0/timthumb_e4078b04e4e326a63034bcce976de702.html" alt="centos开机启动脚本" /><br><span class="r_title">centos开机启动脚本</span></a></li><li class="related_box"  ><a href="/archives/687/index.html" title="centos打造本地网站环境" target="_blank"><img src="/wp-content/themes/yusi1.0/timthumb_0e7b2532d97d8dcd97e569611a80b76b.html" alt="centos打造本地网站环境" /><br><span class="r_title">centos打造本地网站环境</span></a></li></ul><div class="relates"><ul><li><i class="fa fa-minus"></i><a target="_blank" href="/archives/703/index.html">bash脚本计算某程序的进程数</a></li><li><i class="fa fa-minus"></i><a target="_blank" href="/archives/701/index.html">gif添加水印</a></li><li><i class="fa fa-minus"></i><a target="_blank" href="/archives/692/index.html">centos开机启动脚本</a></li><li><i class="fa fa-minus"></i><a target="_blank" href="/archives/687/index.html">centos打造本地网站环境</a></li><li><i class="fa fa-minus"></i><a target="_blank" href="/archives/685/index.html">XAMPP建立多个网站</a></li><li><i class="fa fa-minus"></i><a target="_blank" href="/archives/677/index.html">获取免费的https证书</a></li><li><i class="fa fa-minus"></i><a target="_blank" href="/archives/671/index.html">bat脚本启动后进入当前目录</a></li><li><i class="fa fa-minus"></i><a target="_blank" href="/archives/666/index.html">反汇编相关</a></li></ul></div></div></div></div></div><aside class="sidebar"><div class="widget widget_text"><div class="textwidget"><div class="social"></div></div></div><div class="widget widget_categories"><div class="title"><h2>分类目录</h2></div><ul><li class="cat-item cat-item-9"><a href="/archives/category/c/index.html" >C/C++基础</a></li><li class="cat-item cat-item-5"><a href="/archives/category//index.html" >工作技术</a></li><li class="cat-item cat-item-1"><a href="/archives/category/uncategorized/index.html" >未分类</a></li></ul></div></aside></section><footer class="footer"><div class="footer-inner"><div class="copyright pull-left"><a href="/" title="lei.cool">lei.cool</a> 版权所有，保留一切权利，联系站长815219799@qq.com
        </div><div class="trackcode pull-right"><script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1272902413'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s19.cnzz.com/stat.php%3Fid%3D1272902413%26online%3D1%26show%3Dline' type='text/javascript'%3E%3C/script%3E"));</script></div></div></footer><script type="text/javascript">SyntaxHighlighter.all();</script><script type='text/javascript' src='/wp-includes/js/wp-embed_aaba8411f5e7bb6cecf2f82dd74a8577.min.js'></script><script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script></body></html>